<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stock Transfer | RBMI Inventory System</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #cce5ff, #e8f4ff);
    }

    /* === SAME SIDEBAR AS MESS DASHBOARD === */
    .sidebar {
      width: 250px;
      background: linear-gradient(180deg, #007bff, #00c6ff);
      color: white;
      padding-top: 20px;
      position: fixed;
      height: 100vh;
    }
    .sidebar .brand {
      text-align: center;
      margin-bottom: 25px;
    }
    .sidebar .brand img {
      height: 55px;
      border-radius: 8px;
      background: #fff;
      padding: 5px 8px;
    }
    .sidebar .brand h5 {
      font-weight: 400;
      font-size: 16px;
      color: #fff;
      background: rgba(255,255,255,0.15);
      padding: 5px 10px;
      border-radius: 8px;
      display: inline-block;
    }
    .sidebar .nav-link {
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 4px 12px;
    }
    .nav-link.active { background: rgba(255,255,255,0.2); }

    /* === CONTENT AREA EXACT SAME GAP === */
    .main-content {
      margin-left: 260px;
      padding: 20px;
    }

    .section-card {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 3px 12px rgba(0,114,255,0.12);
      margin-bottom: 25px;
    }

    .form-control { border-radius: 8px; }
    .btn-primary { border-radius: 8px; }

    .label-small { font-size: 14px; font-weight: 600; }

    .top-row, .mid-row {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }

    .unit-box { width: 120px; }
  </style>
</head>

<body>

<!-- ====================== SIDEBAR START ======================= -->
<div class="sidebar">
  <div class="brand">
    <img src="{{ url_for('static', filename='images/rbmi_logo.png') }}">
    <h5>RBMI Inventory<br>Management System</h5>
  </div>
  <hr>

  {% if session['role'] == 'manager' %}
    <a class="nav-link" href="{{ url_for('add_item_master') }}"><i class="bi bi-speedometer2"></i> Add Item</a>
    <a class="nav-link" href="{{ url_for('order_received') }}"><i class="bi bi-cart-check"></i> Purchase</a>
    <a class="nav-link" href="{{ url_for('manager_dashboard') }}"><i class="bi bi-box-seam"></i> Stock Dashboard</a>
    <a class="nav-link" href="{{ url_for('mess_dashboard') }}"><i class="bi bi-egg-fried"></i> Mess Dashboard</a>
    <a class="nav-link" href="{{ url_for('canteen_dashboard') }}"><i class="bi bi-shop"></i> Canteen Dashboard</a>
    <a class="nav-link" href="{{ url_for('usage_report') }}"><i class="bi bi-file-earmark-text"></i> Usage Report</a>
    <a class="nav-link active" href="{{ url_for('transfer_stock') }}"><i class="bi bi-arrow-left-right"></i> Stock Transfer</a>

  {% elif session['role'] == 'mess' %}
    <a class="nav-link" href="{{ url_for('mess_dashboard') }}"><i class="bi bi-egg-fried"></i> Mess Dashboard</a>
    <a class="nav-link active" href="{{ url_for('transfer_stock') }}"><i class="bi bi-arrow-left-right"></i> Stock Transfer</a>

  {% elif session['role'] == 'canteen' %}
    <a class="nav-link" href="{{ url_for('canteen_dashboard') }}"><i class="bi bi-shop"></i> Canteen Dashboard</a>
    <a class="nav-link active" href="{{ url_for('transfer_stock') }}"><i class="bi bi-arrow-left-right"></i> Stock Transfer</a>
  {% endif %}

  <a class="nav-link" href="{{ url_for('change_password') }}"><i class="bi bi-key"></i> Change Password</a>
  <a class="nav-link text-danger" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Logout</a>
</div>
<!-- ====================== SIDEBAR END ======================= -->


<!-- ===================== MAIN CONTENT ====================== -->
<div class="main-content">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="section-card">

    <h3 class="mb-4"><i class="bi bi-arrow-left-right"></i> Stock Transfer</h3>

    <form method="POST">

      <!-- ====== UPPER: FROM → TO ====== -->
      <div class="top-row mb-4">
        <div style="flex:1;">
          <label class="label-small">Send From</label>
          {% if editable %}
            <select name="transfer_from" class="form-control">
              <option value="mess" {% if transfer_from_default=='mess' %}selected{% endif %}>Mess</option>
              <option value="canteen" {% if transfer_from_default=='canteen' %}selected{% endif %}>Canteen</option>
            </select>
          {% else %}
            <input class="form-control" value="{{ transfer_from_default|capitalize }}" readonly>
          {% endif %}
        </div>

        <div style="font-size:26px; margin-top:25px; font-weight:bold;">→</div>

        <div style="flex:1;">
          <label class="label-small">Send To</label>
          {% if editable %}
            <select name="transfer_to" class="form-control">
              <option value="mess" {% if transfer_to_default=='mess' %}selected{% endif %}>Mess</option>
              <option value="canteen" {% if transfer_to_default=='canteen' %}selected{% endif %}>Canteen</option>
            </select>
          {% else %}
            <input class="form-control" value="{{ transfer_to_default|capitalize }}" readonly>
          {% endif %}
        </div>
      </div>

      <!-- ====== MIDDLE ROW: ITEM | QTY | UNIT ====== -->
      <div class="mid-row mb-4">

        <!-- ITEM -->
        <div style="flex:2;">
          <label class="label-small">Item Name</label>
          <input type="text" id="itemSearch" placeholder="Search item..." class="form-control mb-1">
          <select id="itemSelect" name="item_id" class="form-control" required>
            <option value="">-- Select Item --</option>
            {% for i in items %}
              <option value="{{ i.item_id }}" data-unit="{{ i.unit }}">
                {{ i.item_name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- QTY -->
        <div style="flex:1;">
          <label class="label-small">Quantity</label>
          <input type="number" step="0.01" min="0.01" name="quantity"
                 id="qtyInput" class="form-control" required>
        </div>

        <!-- UNIT -->
        <div class="unit-box">
          <label class="label-small">Unit</label>
          <input id="unitBox" class="form-control" value="---" readonly>
        </div>

      </div>

      <!-- BUTTON -->
      <div class="text-center">
        <button class="btn btn-primary px-4">
          <i class="bi bi-send"></i> Transfer
        </button>
      </div>

    </form>
  </div>

</div>


<!-- ===================== JAVASCRIPT ====================== -->
<script>
  // show unit auto
  document.getElementById("itemSelect").addEventListener("change", function() {
    const unit = this.options[this.selectedIndex].getAttribute("data-unit");
    document.getElementById("unitBox").value = unit || "---";
    document.getElementById("qtyInput").focus();
  });

  // search items
  document.getElementById("itemSearch").addEventListener("keyup", function() {
    let v = this.value.toLowerCase();
    let options = document.getElementById("itemSelect").options;
    for (let i = 1; i < options.length; i++) {
      let txt = options[i].textContent.toLowerCase();
      options[i].style.display = txt.includes(v) ? "" : "none";
    }
  });

  // keyboard workflow: enter to next
  document.getElementById("itemSearch").addEventListener("keydown", e => {
    if (e.key === "Enter") { e.preventDefault(); document.getElementById("itemSelect").focus(); }
  });
  document.getElementById("itemSelect").addEventListener("keydown", e => {
    if (e.key === "Enter") { e.preventDefault(); document.getElementById("qtyInput").focus(); }
  });
  document.getElementById("qtyInput").addEventListener("keydown", e => {
    if (e.key === "Enter") { e.preventDefault(); e.target.form.submit(); }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
